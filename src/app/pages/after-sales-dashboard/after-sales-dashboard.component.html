<!-- src/app/pages/after-sales-dashboard/after-sales-dashboard.component.html -->
<div class="container-fluid p-4">
  <!-- ===================== HEADER ===================== -->
  <div class="row mb-2">
    <div class="col-12 text-center">
      <h5 class="fw-bold text-dark mb-3">
        Dashboard <span class="text-success">After Sales</span>
      </h5>
    </div>
  </div>

  <!-- ===================== FILTER ===================== -->
  <div class="row mb-2">
    <div class="col-12">
      <app-filter-aftersales-dashboard
        [loading]="loading()"
        [initialFilter]="currentFilter"
        (search)="onSearch($event)"
      ></app-filter-aftersales-dashboard>
    </div>
  </div>

  <!-- ===================== BREADCRUMB ===================== -->
  <div class="row">
    <div class="col-12">
      <nav aria-label="Filter breadcrumb">
        <ol class="breadcrumb mb-0 bg-light rounded">
          <li class="breadcrumb-item">
            <i class="bi bi-funnel me-1"></i> Filter
          </li>
          <li class="breadcrumb-item">
            <strong>{{ getCompanyDisplayName(currentFilter.company) }}</strong>
          </li>
          <li class="breadcrumb-item">
            {{ getBranchDisplayName(currentFilter.cabang) }}
          </li>
          <li class="breadcrumb-item" aria-current="page">
            {{ getPeriodDisplayName() }}
            @if (currentFilter.compare) {
            <span class="mx-1">|</span>
            <span class="breadcrumb-item active">Komparasi Data</span>
            }
          </li>
        </ol>
      </nav>
    </div>
  </div>

  <!-- ===================== ERROR ===================== -->
  @if (error() && !loading()) {
  <div class="row mb-3">
    <div class="col-12">
      <div class="alert alert-danger border-0 rounded-3" role="alert">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        <strong>Error:</strong> {{ error() }}
      </div>
    </div>
  </div>
  }

  <!-- ===================== LOADING ===================== -->
  @if (loading()) {
  <div class="row">
    <div class="col-12">
      <div
        class="d-flex justify-content-center align-items-center p-5"
        style="min-height: 400px"
      >
        <div
          class="spinner-border text-success"
          style="width: 3rem; height: 3rem"
          role="status"
        >
          <span class="visually-hidden">Memuat dashboard after sales...</span>
        </div>
      </div>
    </div>
  </div>
  }

  <!-- ========================================================== -->
  <!-- SECTION 1: After Sales Summary -->
  <!-- ========================================================== -->
  @if (hasData() && !loading()) {
  <div class="row g-2 mb-2">
    <div class="col-12">
      <div
        class="d-flex flex-column flex-md-row align-items-md-center justify-content-md-between gap-2 my-3"
      >
        <div class="d-flex align-items-center">
          <i class="bi bi-speedometer2 text-success me-2 fs-5"></i>
          <h6 class="mb-0 fw-bold text-dark">After Sales Performance</h6>
        </div>
      </div>
    </div>

    <!-- Jumlah Mekanik - tampil saat filter 1 bulan -->
    @if (showJumlahMekanik()) {
    <div class="col-6 col-sm-4 col-md-6 col-lg-2">
      <app-kpi-card
        [title]="'Jumlah Mekanik'"
        [value]="selectedMetrics()?.mekanik ?? 0"
        [unitLabel]="'orang'"
        [subtitle]="'Total mekanik aktif'"
        [compareMode]="currentFilter.compare || false"
        [prevYearValue]="
          prevYearBlock()?.metrics?.mekanik ??
          prevDateBlock()?.metrics?.mekanik ??
          0
        "
        [prevYearSubtitle]="
          prevYearBlock()?.period ?? prevDateBlock()?.period ?? ''
        "
        [prevMonthValue]="prevMonthBlock()?.metrics?.mekanik ?? 0"
        [prevMonthSubtitle]="prevMonthBlock()?.period ?? ''"
      />
    </div>
    }

    <!-- Jumlah Hari Kerja - sembunyikan jika semua cabang + all-month -->
    @if (showJumlahHariKerja()) {
    <div class="col-6 col-sm-4 col-md-6 col-lg-2">
      <app-kpi-card
        [title]="'Jumlah Hari Kerja'"
        [value]="selectedMetrics()?.hari_kerja ?? 0"
        unit="hari"
        [subtitle]="compare ? '' : 'Total hari operasional'"
        icon="bi bi-calendar-check-fill"
        iconColor="#F59E0B"
        iconBgColor="#FEF3C7"
        [compareMode]="currentFilter.compare"
        [prevYearValue]="
          prevYearBlock()?.metrics?.hari_kerja ??
          prevDateBlock()?.metrics?.hari_kerja ??
          0
        "
        [prevYearSubtitle]="
          prevYearBlock()?.period ?? prevDateBlock()?.period ?? ''
        "
        [prevMonthValue]="prevMonthBlock()?.metrics?.hari_kerja ?? 0"
        [prevMonthSubtitle]="prevMonthBlock()?.period ?? ''"
      />
    </div>
    }

    <!-- Total Biaya Usaha -->
    <div class="col-6 col-sm-4 col-md-6 col-lg-2">
      <app-kpi-card
        [title]="'Total Biaya Usaha'"
        [value]="selectedMetrics()?.biaya_usaha ?? 0"
        [subtitle]="compare ? '' : 'Break Even Point'"
        dataType="currency"
        icon="bi bi-cash-stack"
        iconColor="#228000"
        iconBgColor="#DCFFD0"
        [compareMode]="
          currentFilter.useCustomDate ? false : currentFilter.compare
        "
        [prevYearValue]="
          prevYearBlock()?.metrics?.biaya_usaha ??
          prevDateBlock()?.metrics?.biaya_usaha ??
          0
        "
        [prevYearSubtitle]="
          prevYearBlock()?.period ?? prevDateBlock()?.period ?? ''
        "
        [prevMonthValue]="prevMonthBlock()?.metrics?.biaya_usaha ?? 0"
        [prevMonthSubtitle]="prevMonthBlock()?.period ?? ''"
      />
    </div>

    <!-- Total Revenue -->
    <div class="col-6 col-sm-4 col-md-6 col-lg-2">
      <app-kpi-card
        [title]="'Total Revenue Ater Sales'"
        [value]="selectedMetrics()?.total_revenue_realisasi ?? 0"
        [subtitle]="compare ? '' : 'Total Pendapatan After Sales'"
        icon="bi bi-cash"
        iconColor="#2563EB"
        dataType="currency"
        iconBgColor="#DBEAFE"
        [compareMode]="currentFilter.compare"
        [prevYearValue]="
          prevYearBlock()?.metrics?.total_revenue_realisasi ??
          prevDateBlock()?.metrics?.total_revenue_realisasi ??
          0
        "
        [prevYearSubtitle]="
          prevYearBlock()?.period ?? prevDateBlock()?.period ?? ''
        "
        [prevMonthValue]="
          prevMonthBlock()?.metrics?.total_revenue_realisasi ?? 0
        "
        [prevMonthSubtitle]="prevMonthBlock()?.period ?? ''"
      />
    </div>

    <!-- Total Profit -->
    <div class="col-6 col-sm-4 col-md-6 col-lg-2">
      <app-kpi-card
        [title]="'Total Profit Target'"
        [value]="selectedMetrics()?.profit ?? 0"
        [subtitle]="compare ? '' : 'Target'"
        icon="bi bi-bullseye"
        dataType="currency"
        iconColor="#228000"
        iconBgColor="#DCFFD0"
        [compareMode]="currentFilter.compare"
        [prevYearValue]="
          prevYearBlock()?.metrics?.profit ??
          prevDateBlock()?.metrics?.profit ??
          0
        "
        [prevYearSubtitle]="
          prevYearBlock()?.period ?? prevDateBlock()?.period ?? ''
        "
        [prevMonthValue]="prevMonthBlock()?.metrics?.profit ?? 0"
        [prevMonthSubtitle]="prevMonthBlock()?.period ?? ''"
      />`
    </div>
    <!-- Total Profit Realisasi-->
    <div class="col-6 col-sm-4 col-md-6 col-lg-2">
      <app-kpi-card
        [title]="'Total Profit Realisasi'"
        [value]="selectedMetrics()?.profit_realisasi ?? 0"
        [subtitle]="compare ? '' : 'Target'"
        icon="bi bi-bullseye"
        dataType="currency"
        iconColor="#228000"
        iconBgColor="#DCFFD0"
        [compareMode]="currentFilter.compare"
        [prevYearValue]="
          prevYearBlock()?.metrics?.profit_realisasi ??
          prevDateBlock()?.metrics?.profit_realisasi ??
          0
        "
        [prevYearSubtitle]="
          prevYearBlock()?.period ?? prevDateBlock()?.period ?? ''
        "
        [prevMonthValue]="prevMonthBlock()?.metrics?.profit_realisasi ?? 0"
        [prevMonthSubtitle]="prevMonthBlock()?.period ?? ''"
      />`
    </div>
  </div>
  }

  <!-- ========================================================== -->
  <!-- SECTION 3: Pencapaian Cabang + Sisa Hari Kerja -->
  <!-- ========================================================== -->
  @if (hasData() && !loading()) {
  <div class="row g-2">
    <div class="col-12">
      <div
        class="d-flex align-items-center justify-content-between my-3 flex-wrap"
      >
        <div class="d-flex align-items-center gap-2 flex-shrink-0 ms-2">
          <i class="bi bi-flag-fill fs-4" style="color: #006e1a"></i>
          <h6 class="mb-0 fw-bold text-dark">Pencapaian Cabang</h6>
          <app-kpi-legend-button
            [showSisaHariKerja]="sisaHariKerja !== null"
            placement="start"
            [buttonClass]="
              'btn btn-light rounded-circle p-2 shadow-sm border-0'
            "
            [diameter]="32"
          />
        </div>

        <!-- DROPDOWN SISA HARI KERJA -->
        <div class="d-flex align-items-start flex-shrink-0">
          @if (sisaHariKerja !== null && !currentFilter.useCustomDate) {
          <div class="dropdown-section d-flex flex-column align-items-start">
            <label
              for="sisaHariKerja"
              class="form-label text-muted text-start"
              style="
                font-size: 0.7rem;
                line-height: 1.2;
                margin-bottom: 0.25rem !important;
              "
            >
              Sisa Hari Kerja
            </label>

            <select
              id="sisaHariKerja"
              class="form-select form-select-sm"
              style="min-width: 130px; max-width: 160px; font-size: 0.8rem"
              [(ngModel)]="sisaHariKerja"
              (change)="onSisaHariKerjaChange()"
            >
              @for (sh of sisaHariKerjaOptions; track sh.value) {
              <!-- PENTING: pakai ngValue agar tetap number -->
              <option [ngValue]="sh.value">{{ sh.name }}</option>
              }
            </select>
          </div>
          }
        </div>
      </div>

      <!-- ===== GRID KPI CARDS ===== -->
      <div class="row g-2">
        <!-- AFTER SALES -->
        <div class="col-12 col-sm-6 col-md-4 col-lg-2">
          <app-kpi-card-as
            title="AFTER SALES"
            headerColor="#0070D2"
            [realisasi]="
              selectedMetrics()?.after_sales_plus_part_tunai_realisasi ?? 0
            "
            [target]="
              selectedMetrics()?.after_sales_plus_part_tunai_target ?? 0
            "
            [unitEntry]="getTotalUnitEntry()"
            [sisaHariKerja]="getSisaHariKerja()"
            [loading]="loading()"
            [isUnit]="false"
            [isHarapanTarget]="true"
            [compare]="currentFilter.compare || false"
            [prevMPeriod]="prevMonthBlock()?.period ?? ''"
            [prevYPeriod]="
              (prevYearBlock()?.period ?? prevDateBlock()?.period) || ''
            "
            [prevMRealisasi]="
              prevMonthBlock()?.metrics
                ?.after_sales_plus_part_tunai_realisasi ?? 0
            "
            [prevMTarget]="
              prevMonthBlock()?.metrics?.after_sales_plus_part_tunai_target ?? 0
            "
            [prevMDenomForAvg]="
              prevMonthBlock()?.metrics?.unit_entry_realisasi ?? 0
            "
            [prevYRealisasi]="
              prevYearBlock()?.metrics?.after_sales_plus_part_tunai_realisasi ??
              prevDateBlock()?.metrics?.after_sales_plus_part_tunai_realisasi ??
              0
            "
            [prevYTarget]="
              (prevYearBlock()?.metrics?.after_sales_plus_part_tunai_target ??
                prevDateBlock()?.metrics?.after_sales_plus_part_tunai_target) ||
              0
            "
            [prevYDenomForAvg]="
              prevYearBlock()?.metrics?.unit_entry_realisasi || 0
            "
          >
          </app-kpi-card-as>
        </div>
        <!-- Service Cabang -->
        <div class="col-12 col-sm-6 col-md-4 col-lg-2">
          <app-kpi-card-as
            title="SERVICE CABANG"
            headerColor="#0070D2"
            [realisasi]="selectedMetrics()?.service_cabang_realisasi ?? 0"
            [target]="selectedMetrics()?.service_cabang_target ?? 0"
            [unitEntry]="getTotalUnitEntry()"
            [sisaHariKerja]="getSisaHariKerja()"
            [loading]="loading()"
            [isUnit]="false"
            [isHarapanTarget]="true"
            [compare]="currentFilter.compare || false"
            [prevMPeriod]="prevMonthBlock()?.period ?? ''"
            [prevYPeriod]="
              (prevYearBlock()?.period ?? prevDateBlock()?.period) || ''
            "
            [prevMRealisasi]="
              prevMonthBlock()?.metrics?.service_cabang_realisasi ?? 0
            "
            [prevMTarget]="
              prevMonthBlock()?.metrics?.service_cabang_target ?? 0
            "
            [prevMDenomForAvg]="
              prevMonthBlock()?.metrics?.unit_entry_realisasi ?? 0
            "
            [prevYRealisasi]="
              prevYearBlock()?.metrics?.service_cabang_realisasi ??
              prevDateBlock()?.metrics?.service_cabang_realisasi ??
              0
            "
            [prevYTarget]="
              (prevYearBlock()?.metrics?.service_cabang_target ??
                prevDateBlock()?.metrics?.service_cabang_target) || 0
            "
            [prevYDenomForAvg]="
              prevYearBlock()?.metrics?.unit_entry_realisasi || 0
            "
          >
          </app-kpi-card-as>
        </div>

        <!-- JASA SERVICE -->
        <div class="col-12 col-sm-6 col-md-4 col-lg-2">
          <app-kpi-card-as
            title="JASA SERVICE"
            headerColor="#3B00A0"
            [realisasi]="selectedMetrics()?.jasa_service_realisasi ?? 0"
            [target]="selectedMetrics()?.jasa_service_target ?? 0"
            [unitEntry]="getTotalUnitEntry()"
            [sisaHariKerja]="getSisaHariKerja()"
            [loading]="loading()"
            [isUnit]="false"
            [isHarapanTarget]="true"
            [compare]="currentFilter.compare || false"
            [prevMPeriod]="prevMonthBlock()?.period ?? ''"
            [prevYPeriod]="
              (prevYearBlock()?.period ?? prevDateBlock()?.period) || ''
            "
            [prevMRealisasi]="
              prevMonthBlock()?.metrics?.jasa_service_realisasi ?? 0
            "
            [prevMTarget]="prevMonthBlock()?.metrics?.jasa_service_target ?? 0"
            [prevMDenomForAvg]="
              prevMonthBlock()?.metrics?.unit_entry_realisasi ?? 0
            "
            [prevYRealisasi]="
              prevYearBlock()?.metrics?.jasa_service_realisasi ??
              prevDateBlock()?.metrics?.jasa_service_realisasi ??
              0
            "
            [prevYTarget]="
              (prevYearBlock()?.metrics?.jasa_service_target ??
                prevDateBlock()?.metrics?.jasa_service_target) || 0
            "
            [prevYDenomForAvg]="
              prevYearBlock()?.metrics?.unit_entry_realisasi || 0
            "
          >
          </app-kpi-card-as>
        </div>

        <!-- Unit Entry -->
        <div class="col-12 col-sm-6 col-md-4 col-lg-2">
          <app-kpi-card-as
            title="Unit Entry"
            headerColor="#0070D2"
            [realisasi]="selectedMetrics()?.unit_entry_realisasi ?? 0"
            [target]="selectedMetrics()?.unit_entry_target ?? 0"
            [unitEntry]="getTotalUnitEntry()"
            [sisaHariKerja]="getSisaHariKerja()"
            [loading]="loading()"
            [isUnit]="true"
            [isHarapanTarget]="true"
            [compare]="currentFilter.compare || false"
            [prevMPeriod]="prevMonthBlock()?.period ?? ''"
            [prevYPeriod]="
              (prevYearBlock()?.period ?? prevDateBlock()?.period) || ''
            "
            [prevMRealisasi]="
              prevMonthBlock()?.metrics?.unit_entry_realisasi ?? 0
            "
            [prevMTarget]="prevMonthBlock()?.metrics?.unit_entry_target ?? 0"
            [prevMDenomForAvg]="
              prevMonthBlock()?.metrics?.unit_entry_realisasi ?? 0
            "
            [prevYRealisasi]="
              prevYearBlock()?.metrics?.unit_entry_realisasi ??
              prevDateBlock()?.metrics?.unit_entry_realisasi ??
              0
            "
            [prevYTarget]="
              (prevYearBlock()?.metrics?.unit_entry_target ??
                prevDateBlock()?.metrics?.unit_entry_target) || 0
            "
            [prevYDenomForAvg]="
              prevYearBlock()?.metrics?.unit_entry_realisasi || 0
            "
          >
          </app-kpi-card-as>
        </div>

        <!-- PART TUNAI -->
        <div class="col-12 col-sm-6 col-md-4 col-lg-2">
          <app-kpi-card-as
            title="SPAREPART TUNAI"
            headerColor="#004B66"
            [realisasi]="selectedMetrics()?.part_tunai_realisasi ?? 0"
            [target]="selectedMetrics()?.part_tunai_target ?? 0"
            [unitEntry]="getTotalUnitEntry()"
            [sisaHariKerja]="getSisaHariKerja()"
            [loading]="loading()"
            [isUnit]="false"
            [isHarapanTarget]="true"
            [compare]="currentFilter.compare || false"
            [prevMPeriod]="prevMonthBlock()?.period ?? ''"
            [prevYPeriod]="
              (prevYearBlock()?.period ?? prevDateBlock()?.period) || ''
            "
            [prevMRealisasi]="
              prevMonthBlock()?.metrics?.part_tunai_realisasi ?? 0
            "
            [prevMTarget]="prevMonthBlock()?.metrics?.part_tunai_target ?? 0"
            [prevMDenomForAvg]="
              prevMonthBlock()?.metrics?.unit_entry_realisasi ?? 0
            "
            [prevYRealisasi]="
              prevYearBlock()?.metrics?.part_tunai_realisasi ??
              prevDateBlock()?.metrics?.part_tunai_realisasi ??
              0
            "
            [prevYTarget]="
              (prevYearBlock()?.metrics?.part_tunai_target ??
                prevDateBlock()?.metrics?.part_tunai_target) || 0
            "
            [prevYDenomForAvg]="
              prevYearBlock()?.metrics?.unit_entry_realisasi || 0
            "
          >
          </app-kpi-card-as>
        </div>

        <!-- PART BENGKEL -->
        <div class="col-12 col-sm-6 col-md-4 col-lg-2">
          <app-kpi-card-as
            title="SPAREPART BENGKEL"
            headerColor="#890000"
            [realisasi]="selectedMetrics()?.part_bengkel_realisasi ?? 0"
            [target]="selectedMetrics()?.part_bengkel_target ?? 0"
            [unitEntry]="getTotalUnitEntry()"
            [sisaHariKerja]="getSisaHariKerja()"
            [loading]="loading()"
            [isUnit]="false"
            [isHarapanTarget]="true"
            [compare]="currentFilter.compare || false"
            [prevMPeriod]="prevMonthBlock()?.period ?? ''"
            [prevYPeriod]="
              (prevYearBlock()?.period ?? prevDateBlock()?.period) || ''
            "
            [prevMRealisasi]="
              prevMonthBlock()?.metrics?.part_bengkel_realisasi ?? 0
            "
            [prevMTarget]="prevMonthBlock()?.metrics?.part_bengkel_target ?? 0"
            [prevMDenomForAvg]="
              prevMonthBlock()?.metrics?.unit_entry_realisasi ?? 0
            "
            [prevYRealisasi]="
              prevYearBlock()?.metrics?.part_bengkel_realisasi ??
              prevDateBlock()?.metrics?.part_bengkel_realisasi ??
              0
            "
            [prevYTarget]="
              (prevYearBlock()?.metrics?.part_bengkel_target ??
                prevDateBlock()?.metrics?.part_bengkel_target) || 0
            "
            [prevYDenomForAvg]="
              prevYearBlock()?.metrics?.unit_entry_realisasi || 0
            "
          >
          </app-kpi-card-as>
        </div>

        <!-- OLI -->
        <div class="col-12 col-sm-6 col-md-4 col-lg-2">
          <app-kpi-card-as
            title="SPAREPART OLI"
            headerColor="#890000"
            [realisasi]="selectedMetrics()?.ganti_oli_realisasi ?? 0"
            [target]="selectedMetrics()?.ganti_oli_target ?? 0"
            [unitEntry]="getTotalUnitEntry()"
            [sisaHariKerja]="getSisaHariKerja()"
            [loading]="loading()"
            [isUnit]="false"
            [isHarapanTarget]="true"
            [compare]="currentFilter.compare || false"
            [prevMPeriod]="prevMonthBlock()?.period ?? ''"
            [prevYPeriod]="
              (prevYearBlock()?.period ?? prevDateBlock()?.period) || ''
            "
            [prevMRealisasi]="
              prevMonthBlock()?.metrics?.part_bengkel_realisasi ?? 0
            "
            [prevMTarget]="prevMonthBlock()?.metrics?.part_bengkel_target ?? 0"
            [prevMDenomForAvg]="
              prevMonthBlock()?.metrics?.unit_entry_realisasi ?? 0
            "
            [prevYRealisasi]="
              prevYearBlock()?.metrics?.part_bengkel_realisasi ??
              prevDateBlock()?.metrics?.part_bengkel_realisasi ??
              0
            "
            sd
            [prevYTarget]="
              (prevYearBlock()?.metrics?.part_bengkel_target ??
                prevDateBlock()?.metrics?.part_bengkel_target) || 0
            "
            [prevYDenomForAvg]="
              prevYearBlock()?.metrics?.unit_entry_realisasi || 0
            "
          >
          </app-kpi-card-as>
        </div>
      </div>
    </div>
  </div>
  <!-- ========================================================== -->
  <!-- SECTION 4: Pencapaian SRO + Sisa Hari Kerja -->
  <!-- ========================================================== -->
  <div class="row g-2">
    <div class="col-12">
      <div
        class="d-flex flex-column flex-md-row align-items-md-center justify-content-md-between gap-2 my-3"
      >
        <div class="d-flex align-items-center">
          <i class="bi bi-speedometer2 text-success me-2 fs-5"></i>
          <h6 class="mb-0 fw-bold text-dark">PENCAPAIAN SRO</h6>
        </div>
      </div>

      <div class="d-flex align-items-center">
        <i class="bi bi-speedometer2 text-success me-2 fs-5"></i>
        <h6 class="mb-0 text-dark">CPUS Unit</h6>
      </div>

      <!--  Ganti Oli Unit-->
      <div class="col-12 col-sm-6 col-md-4 col-lg-2">
        <app-kpi-card-as
          title="SPAREPART OLI"
          headerColor="#890000"
          [realisasi]="selectedMetrics()?.unit_entry_oli_realisasi ?? 0"
          [target]="selectedMetrics()?.unit_entry_oli_realisasi ?? 0"
          [unitEntry]="getTotalUnitEntry()"
          [sisaHariKerja]="getSisaHariKerja()"
          [loading]="loading()"
          [isUnit]="false"
          [isHarapanTarget]="true"
          [compare]="currentFilter.compare || false"
          [prevMPeriod]="prevMonthBlock()?.period ?? ''"
          [prevYPeriod]="
            (prevYearBlock()?.period ?? prevDateBlock()?.period) || ''
          "
          [prevMRealisasi]="
            prevMonthBlock()?.metrics?.unit_entry_oli_realisasi ?? 0
          "
          [prevMTarget]="prevMonthBlock()?.metrics?.unit_entry_oli_realisasi ?? 0"
          [prevMDenomForAvg]="
            prevMonthBlock()?.metrics?.unit_entry_realisasi ?? 0
          "
          [prevYRealisasi]="
            prevYearBlock()?.metrics?.unit_entry_oli_realisasi ??
            prevDateBlock()?.metrics?.unit_entry_oli_realisasi ??
            0
          "
          [prevYTarget]="
            (prevYearBlock()?.metrics?.unit_entry_oli_realisasi ??
              prevDateBlock()?.metrics?.unit_entry_oli_realisasi) || 0
          "
          [prevYDenomForAvg]="
            prevYearBlock()?.metrics?.unit_entry_realisasi || 0
          "
        >
        </app-kpi-card-as>
      </div>
    </div>
  </div>
  }

  <!-- ========================================================== -->
  <!-- SECTION 4: SRO + Sisa Hari Kerja (opsional, belum diisi) -->
  <!-- ========================================================== -->

  <!-- ===================== EMPTY STATE ===================== -->
  @if (!hasData() && !loading() && !error()) {
  <div class="row">
    <div class="col-12">
      <div class="text-center py-5">
        <i class="bi bi-bar-chart text-muted fs-1 mb-3"></i>
        <h6 class="text-muted mb-0">
          Belum ada data untuk ditampilkan. Silakan pilih filter dan klik cari.
        </h6>
      </div>
    </div>
  </div>
  }
</div>
