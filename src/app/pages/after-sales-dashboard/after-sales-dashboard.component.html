<div class="container-fluid p-4">
  <!-- Header dan Filter -->
  <div class="row mb-2">
    <div class="col-12 text-center">
      <h5 class="fw-bold text-dark mb-3">
        Dashboard <span class="text-success">After Sales</span>
      </h5>
    </div>

    <div class="row mb-2">
      <div class="col-12">
        <app-filter-aftersales-dashboard
          [loading]="loading()"
          [initialFilter]="currentFilter()"
          (search)="onSearch($event)"
        >
        </app-filter-aftersales-dashboard>
      </div>
    </div>
    <!-- Alternative: Breadcrumb Style Filter Display -->
    <div class="row">
      <div class="col-12">
        <nav aria-label="Filter breadcrumb">
          <ol class="breadcrumb mb-0 bg-light rounded">
            <li class="breadcrumb-item">
              <i class="bi bi-funnel me-1"></i>
              Filter
            </li>
            <li class="breadcrumb-item">
              <strong>{{
                getCompanyDisplayName(currentFilter()?.company ?? "")
              }}</strong>
            </li>
            <li class="breadcrumb-item">
              {{ getBranchDisplayName(currentFilter()?.cabang ?? "") }}
            </li>
            <li class="breadcrumb-item" aria-current="page">
              {{ getPeriodDisplayName() }}

              @if (currentFilter()?.compare) { |
              <span class="breadcrumb-item active">Komparasi Data</span>
              }
            </li>
          </ol>
        </nav>
      </div>
    </div>
  </div>

  <!-- Error Alert -->
  @if (error() && !loading()) {
  <div class="row mb-4">
    <div class="col-12">
      <div class="alert alert-danger border-0 rounded-3" role="alert">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        <strong>Error:</strong> {{ error() }}
      </div>
    </div>
  </div>
  }

  <!-- Global Loading Spinner -->
  @if (loading()) {
  <div class="row">
    <div class="col-12">
      <div
        class="d-flex justify-content-center align-items-center p-5"
        style="min-height: 400px"
      >
        <div
          class="spinner-border text-success"
          style="width: 3rem; height: 3rem"
          role="status"
        >
          <span class="visually-hidden">Memuat dashboard after sales...</span>
        </div>
      </div>
    </div>
  </div>
  }
  <!-- ========================================================== -->
  <!-- SECTION 1: After Sales Summary -->
  <!-- ========================================================== -->
  @if (hasData() && !loading() && additionalKpiData()) {

  <div class="row g-2 mb-2">
    <div class="col-12">
      <div class="d-flex align-items-center">
        <i class="bi bi-speedometer2 text-success me-2 fs-5"></i>
        <h6 class="mb-0 fw-bold text-dark">After Sales Performance</h6>
      </div>
    </div>

    <!-- Jumlah Mekanik - Hanya tampil jika pilih 1 bulan -->
    @if (showJumlahMekanik()) {
    <div class="col-6 col-sm-4 col-md-6 col-lg-2">
      <app-kpi-card
        [title]="'Jumlah Mekanik'"
        [value]="additionalKpiData()!.jumlahMekanik"
        [unitLabel]="'orang'"
        [subtitle]="'Total mekanik aktif'"
        [period]="periodForCards()"
        [series]="{
          '2024-08': 2,
          '2025-07': 3,
          '2025-08': 3,
          '2024': 3,
          '2025': 3
        }"
        [compareMode]="true"
      />
    </div>
    }

    <!-- Jumlah Hari Kerja - Jangan tampil jika semua cabang + semua bulan -->
    @if (showJumlahHariKerja()) {
    <div class="col-6 col-sm-4 col-md-6 col-lg-2">
      <app-kpi-card
        [title]="'Jumlah Hari Kerja'"
        [value]="additionalKpiData()!.jumlahHariKerja"
        unit="hari"
        [subtitle]="compare ? '' : 'Total hari operasional'"
        icon="bi bi-calendar-check-fill"
        iconColor="#F59E0B"
        iconBgColor="#FEF3C7"
        [period]="periodForCards()"
        [series]="{
          '2024-08': 2,
          '2025-07': 3,
          '2025-08': 3,
          '2024': 3,
          '2025': 3
        }"
        [compareMode]="true"
      />
    </div>
    }

    <!-- Total Biaya Usaha -->
    <div class="col-6 col-sm-4 col-md-6 col-lg-2">
      <app-kpi-card
        [title]="'Total Biaya Usaha'"
        [value]="formatCompactNumber(additionalKpiData()!.totalBiayaUsaha)"
        [subtitle]="compare ? '' : 'Break Even Point'"
        dataType="currency"
        icon="bi bi-cash-stack"
        iconColor="#228000"
        iconBgColor="#DCFFD0"
        [period]="periodForCards()"
        [series]="{
          '2024-08': 2,
          '2025-07': 3,
          '2025-08': 3,
          '2024': 3,
          '2025': 3
        }"
        [compareMode]="true"
      />
    </div>

    <!-- Total Revenue -->
    <div class="col-6 col-sm-4 col-md-6 col-lg-2">
      <app-kpi-card
        [title]="'Total Revenue After Sales'"
        [value]="
          formatCompactNumber(additionalKpiData()!.totalRevenueRealisasi)
        "
        [subtitle]="compare ? '' : 'Total Pendapatan After Sales'"
        icon="bi bi-cash"
        iconColor="#2563EB"
        iconBgColor="#DBEAFE"
        [period]="periodForCards()"
        [series]="{
          '2024-08': 2,
          '2025-07': 3,
          '2025-08': 3,
          '2024': 3,
          '2025': 3
        }"
        [compareMode]="true"
      />
    </div>

    <!-- Total Profit -->
    <div class="col-6 col-sm-4 col-md-6 col-lg-2">
      <app-kpi-card
        [title]="'Total Profit'"
        [value]="formatCompactNumber(additionalKpiData()!.totalProfit)"
        [subtitle]="compare ? '' : 'Target'"
        icon="bi bi-bullseye"
        iconColor="#228000"
        iconBgColor="#DCFFD0"
        [period]="periodForCards()"
        [series]="{
          '2024-08': 2,
          '2025-07': 3,
          '2025-08': 3,
          '2024': 3,
          '2025': 3
        }"
        [compareMode]="true"
      />
    </div>

    <!--Total Profit Realisasi-->
    <div class="col-6 col-sm-4 col-md-6 col-lg-2">
      <app-kpi-card
        [title]="'Total Profit Realisasi'"
        [value]="formatCompactNumber(additionalKpiData()!.totalProfitRealisasi)"
        [subtitle]="compare ? '' : 'Keuntungan bersih'"
        icon="bi bi-graph-up-arrow"
        iconColor="#16A34A"
        iconBgColor="#DCFCE7"
        [period]="periodForCards()"
        [series]="{
          '2024-08': 2,
          '2025-07': 3,
          '2025-08': 3,
          '2024': 3,
          '2025': 3
        }"
        [compareMode]="true"
      />
    </div>
  </div>

  <!-- ========================================================== -->
  <!-- SECTION 1: After Sales Summary -->
  <!-- ========================================================== -->

  <!-- ========================================================== -->
  <!-- SECTION 2: Chart Section -->
  <!-- ========================================================== -->
  <div class="row g-2 mb-5">
    @if (totalRevenueChart(); as revenueChart) {
    <div class="col-12 col-lg-4">
      <app-line-chart-card
        [label]="'Total Revenue'"
        [title]="
          'Trend Total Revenue After Sales per Bulan (Tahun ' +
          currentFilter()?.period +
          ')'
        "
        [labels]="totalRevenueChart()!.labels"
        [data]="totalRevenueChart()!.data"
        [height]="250"
        [showLegend]="false"
        [borderColor]="'#00821E'"
        [backgroundColor]="'rgba(117, 255, 110, 0.30)'"
        [pointBackgroundColor]="'#00821E'"
        [fill]="true"
      >
      </app-line-chart-card>
    </div>
    } @if (afterSalesDistribution()) {
    <div class="col-12 col-lg-2">
      <app-pie-chart-card
        [title]="'Proporsi After Sales'"
        [labels]="afterSalesDistribution()!.labels"
        [data]="afterSalesDistribution()!.data"
        [height]="200"
        [showLegend]="true"
        [chartType]="'currency'"
      />
    </div>
    }
  </div>

  <!-- ========================================================== -->
  <!-- SECTION 2: Chart Section -->
  <!-- ========================================================== -->

  } @if (hasData() && !loading()) {
  <div class="row g-2">
    <div class="col-12">
      <!-- Header Section -->
      <div
        class="d-flex align-items-center justify-content-between my-3 flex-wrap"
      >
        <!-- Left side: Title dengan icon -->
        <div class="d-flex align-items-center gap-2 flex-shrink-0 ms-2">
          <i class="bi bi-flag-fill fs-4" style="color: #006e1a"></i>
          <h6 class="mb-0 fw-bold text-dark">Pencapaian Cabang</h6>
          <app-kpi-legend-button
            [showSisaHariKerja]="showSisaHariKerja()"
            placement="start"
            [buttonClass]="
              'btn btn-light rounded-circle p-2 shadow-sm border-0'
            "
            [diameter]="32"
          />
        </div>

        <!-- Right side: Dropdown -->
        <div class="d-flex align-items-start flex-shrink-0">
          @if (showSisaHariKerja()) {
          <div class="dropdown-section d-flex flex-column align-items-start">
            <!-- Label di atas dropdown -->
            <label
              for="sisaHariKerja"
              class="form-label text-muted text-start"
              style="
                font-size: 0.7rem;
                line-height: 1.2;
                margin-bottom: 0.25rem !important;
              "
            >
              Sisa Hari Kerja
            </label>

            <!-- Dropdown -->
            <select
              id="sisaHariKerja"
              class="form-select form-select-sm"
              style="min-width: 130px; max-width: 160px; font-size: 0.8rem"
              [(ngModel)]="sisaHariKerja"
              (change)="onSisaHariKerjaChange()"
            >
              @for (sh of sisaHariKerjaOptions; track sh.value) {
              <option [value]="sh.value">{{ sh.name }}</option>
              }
            </select>
          </div>
          }
        </div>
      </div>
    </div>

    <!-- KPI Cards - 5 per row dengan Bootstrap custom class -->
    <!-- After Sales Realisasi vs Target -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="AFTER SALES REALISASI vs TARGET"
        headerColor="#0070D2"
        [realisasi]="kpiData()!.afterSales.realisasi"
        [target]="kpiData()!.afterSales.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="false"
        [isHarapanTarget]="true"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>

    <!-- Service Cabang Realisasi vs Target -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="SERVICE CABANG REALISASI vs TARGET"
        headerColor="#3B00A0"
        [realisasi]="kpiData()!.serviceCabang.realisasi"
        [target]="kpiData()!.serviceCabang.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="false"
        [isHarapanTarget]="true"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>

    <!-- Jasa Service Realisasi vs Target -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="JASA SERVICE REALISASI vs TARGET"
        headerColor="#3B00A0"
        [realisasi]="kpiData()!.jasaService.realisasi"
        [target]="kpiData()!.jasaService.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="false"
        [isHarapanTarget]="true"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>
    <!-- Unit Entry Realisasi vs Target -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="UNIT ENTRY REALISASI vs TARGET"
        headerColor="#588000"
        [realisasi]="kpiData()!.unitEntry.realisasi"
        [target]="kpiData()!.unitEntry.target"
        [sisaHariKerja]="getSisaHariKerja()"
        [mekanik]="additionalKpiData()?.jumlahMekanik"
        [loading]="loading()"
        [isUnit]="true"
        [isHarapanTarget]="true"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>

    <!-- Sparepart Tunai Realisasi vs Target -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="SPAREPART TUNAI REALISASI vs TARGET"
        headerColor="#004B66"
        [realisasi]="kpiData()!.sparepartTunai.realisasi"
        [target]="kpiData()!.sparepartTunai.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="false"
        [isHarapanTarget]="true"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>

    <!-- Row 2: Remaining cards -->
    <!-- Sparepart Bengkel Realisasi vs Target -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="SPAREPART BENGKEL REALISASI vs TARGET"
        headerColor="#890000"
        [realisasi]="kpiData()!.sparepartBengkel.realisasi"
        [target]="kpiData()!.sparepartBengkel.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="false"
        [isHarapanTarget]="true"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>

    <!-- OLI Realisasi vs Target -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="OLI REALISASI vs TOTAL"
        headerColor="#944700"
        [realisasi]="kpiData()!.oli.realisasi"
        [target]="kpiData()!.oli.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="false"
        [isHarapanTarget]="true"
      >
      </app-kpi-card-as>
    </div>
  </div>

  <!-- ========================================================== -->
  <!-- SECTION 4: Pencapaian SRO (KPI Cards AS yang sudah ada) -->
  <!-- ========================================================== -->
  <div class="row g-2">
    <div class="col-12">
      <div class="d-flex align-items-center justify-content-start my-3 ms-2">
        <div class="d-flex align-items-center">
          <i class="bi bi-tools me-2 fs-4" style="color: #006e1a"></i>
          <h4 class="mb-0 fw-bold text-dark">Pencapaian SRO</h4>
        </div>
      </div>
    </div>
    <div class="d-flex align-items-center">
      <i
        class="bi bi-gear-wide-connected me-2 fs-4 ms-2"
        style="color: #3b00a0"
      ></i>
      <h6 class="mb-0 fw-bold text-dark">CPUS SERVICE</h6>
    </div>
    <!-- Jasa Service Express Realisasi vs Target -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="JASA SERVICE EXPRESS REALISASI vs TOTAL"
        headerColor="#3B00A0"
        [realisasi]="kpiData()!.jasaServiceExpress.realisasi"
        [target]="kpiData()!.jasaServiceExpress.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="false"
        [isHarapanTarget]="false"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>

    <!-- Jasa Service Rutin Realisasi vs TOTAL -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="JASA SERVICE RUTIN vs TOTAL"
        headerColor="#3B00A0"
        [realisasi]="kpiData()!.jasaServiceRutin.realisasi"
        [target]="kpiData()!.jasaServiceRutin.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="false"
        [isHarapanTarget]="false"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>
    <!-- Jasa Service sedang Realisasi vs TOTAL -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="JASA SERVICE SEDANG vs TOTAL"
        headerColor="#3B00A0"
        [realisasi]="kpiData()!.jasaServiceSedang.realisasi"
        [target]="kpiData()!.jasaServiceSedang.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="false"
        [isHarapanTarget]="false"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>

    <!-- Jasa Service Berat vs Target -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="JASA SERVICE BERAT REALISASI vs TOTAL"
        headerColor="#3B00A0"
        [realisasi]="kpiData()!.jasaServiceBerat.realisasi"
        [target]="kpiData()!.jasaServiceBerat.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="false"
        [isHarapanTarget]="false"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>
    <!-- Jasa Service oli Realisasi vs Target -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="JASA SERVICE OLI REALISASI vs TOTAL"
        headerColor="#3B00A0"
        [realisasi]="kpiData()!.jasaServiceOli.realisasi"
        [target]="kpiData()!.jasaServiceOli.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="false"
        [isHarapanTarget]="false"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>
    <!-- Jasa Service Overhoul Realisasi vs TOTAL -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="JASA SERVICE OVERHOUL REALISASI vs TOTAL"
        headerColor="#3B00A0"
        [realisasi]="kpiData()!.jasaServiceOverhoul.realisasi"
        [target]="kpiData()!.jasaServiceOverhoul.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="false"
        [isHarapanTarget]="false"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>
    <!-- Jasa Service Kelistrikan  Realisasi vs Target -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="JASA SERVICE KELISTRIKAN REALISASI vs TOTAL"
        headerColor="#3B00A0"
        [realisasi]="kpiData()!.jasaServiceKelistrikan.realisasi"
        [target]="kpiData()!.jasaServiceKelistrikan.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="false"
        [isHarapanTarget]="false"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>

    <!-- Jasa Service CVT Realisasi vs Target -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="JASA SERVICE CVT REALISASI vs TOTAL"
        headerColor="#3B00A0"
        [realisasi]="kpiData()!.jasaServiceCvt.realisasi"
        [target]="kpiData()!.jasaServiceCvt.target"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="false"
        [isHarapanTarget]="false"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>
    <!-- Jasa Service Body Repair Realisasi vs Target -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="SABLET JASA SERVICE BODY REPAIR REALISASI vs TOTAL"
        headerColor="#3B00A0"
        [realisasi]="kpiData()!.jasaServiceBodyRepair.realisasi"
        [target]="kpiData()!.jasaServiceBodyRepair.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="false"
        [isHarapanTarget]="false"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>
    <!-- Jasa Service Over Size Realisasi vs TOTAL -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="SABLET JASA SERVICE OVER SIZE REALISASI vs TOTAL"
        headerColor="#3B00A0"
        [realisasi]="kpiData()!.jasaServiceOverSize.realisasi"
        [target]="kpiData()!.jasaServiceOverSize.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="false"
        [isHarapanTarget]="false"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>
    <div class="d-flex align-items-center ms-2">
      <i class="bi bi-receipt-cutoff me-2 fs-4" style="color: #3b00a0"></i>

      <h6 class="mb-0 fw-bold text-dark">NON CPUS SERVICE</h6>
    </div>

    <!-- JASA SERVICE CLAIM Realisasi vs TOTAL -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="JASA SERVICE CLAIM REALISASI vs TOTAL"
        headerColor="#3B00A0"
        [realisasi]="kpiData()!.jasaServiceClaim.realisasi"
        [target]="kpiData()!.jasaServiceClaim.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="false"
        [isHarapanTarget]="false"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>
    <!-- JASA SERVICE KUPON Realisasi vs TOTAL -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="JASA SERVICE KUPON REALISASI VS TOTAL"
        headerColor="#3B00A0"
        [realisasi]="kpiData()!.jasaServiceKupon.realisasi"
        [target]="kpiData()!.jasaServiceKupon.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="false"
        [isHarapanTarget]="false"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>
    <!-- JASA SERVICE PDC Realisasi vs TOTAL -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="JASA SERVICE PDC REALISASI vs TOTAL"
        headerColor="#3B00A0"
        [realisasi]="kpiData()!.jasaServicePdc.realisasi"
        [target]="kpiData()!.jasaServicePdc.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="false"
        [isHarapanTarget]="false"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>

    <div class="d-flex align-items-center ms-2">
      <i class="bi bi-gear-fill text-danger me-2 fs-4"></i>
      <h6 class="mb-0 fw-bold text-dark">CPUS SPAREPART BENGKEL</h6>
    </div>

    <!-- SPAREPART BENGKEL EXPRESS Realisasi vs TOTAL -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="SPAREPART BENGKEL EXPRESS REALISASI vs TOTAL"
        headerColor="#890000"
        [realisasi]="kpiData()!.partBengkelExpress.realisasi"
        [target]="kpiData()!.partBengkelOli.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="false"
        [isHarapanTarget]="false"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="SPAREPART BENGKEL RUTIN REALISASI vs TOTAL"
        headerColor="#890000"
        [realisasi]="kpiData()!.partBengkelRutin.realisasi"
        [target]="kpiData()!.partBengkelRutin.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="false"
        [isHarapanTarget]="false"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>
    <!-- SPAREPART BENGKEL SEDANG Realisasi vs TOTAL -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="SPAREPART BENGKEL SEDANG  REALISASI vs TOTAL"
        headerColor="#890000"
        [realisasi]="kpiData()!.partBengkelSedang.realisasi"
        [target]="kpiData()!.partBengkelSedang.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="false"
        [isHarapanTarget]="false"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>
    <!-- SPAREPART BENGKEL BERAT Realisasi vs TOTAL -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="SPAREPART BENGKEL BERAT  REALISASI vs TOTAL"
        headerColor="#890000"
        [realisasi]="kpiData()!.partBengkelBerat.realisasi"
        [target]="kpiData()!.partBengkelBerat.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="false"
        [isHarapanTarget]="false"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>
    <!-- SPAREPART BENGKEL OLI Realisasi vs TOTAL -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="SPAREPART BENGKEL OLI REALISASI vs TOTAL"
        headerColor="#890000"
        [realisasi]="kpiData()!.partBengkelOli.realisasi"
        [target]="kpiData()!.partBengkelOli.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="false"
        [isHarapanTarget]="false"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>
    <!-- SPAREPART BENGKEL OVERHOUL Realisasi vs TOTAL -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="SPAREPART BENGKEL OVERHOUL REALISASI vs TOTAL"
        headerColor="#890000"
        [realisasi]="kpiData()!.partBengkelOverhoul.realisasi"
        [target]="kpiData()!.partBengkelOverhoul.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="false"
        [isHarapanTarget]="false"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>

    <div class="d-flex align-items-center ms-2">
      <i class="bi bi-car-front me-2 fs-4" style="color: #588000"></i>
      <h6 class="mb-0 fw-bold text-dark">CPUS UNIT ENTRY</h6>
    </div>

    <!-- UNIT ENTRY GANTI OLI REALISASI vs TOTAL -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="UNIT ENTRY GANTI OLI REALISASI vs TOTAL"
        headerColor="#588000"
        [realisasi]="kpiData()!.unitEntryOliRealisasi.realisasi"
        [target]="kpiData()!.unitEntry.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="true"
        [mekanik]="additionalKpiData()?.jumlahMekanik"
        [isHarapanTarget]="false"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>
    <!-- UNIT ENTRY EXPRESS REALISASI vs TOTAL -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="UNIT ENTRY EXPRESS REALISASI vs TOTAL"
        headerColor="#588000"
        [realisasi]="kpiData()!.unitEntryExpressRealisasi.realisasi"
        [target]="kpiData()!.unitEntry.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="true"
        [mekanik]="additionalKpiData()?.jumlahMekanik"
        [isHarapanTarget]="false"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>

    <!-- UNIT ENTRY RUTIN REALISASI vs TOTAL -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="UNIT ENTRY RUTIN REALISASI vs TOTAL"
        headerColor="#588000"
        [realisasi]="kpiData()!.unitEntryRutinRealisasi.realisasi"
        [target]="kpiData()!.unitEntry.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="true"
        [mekanik]="additionalKpiData()?.jumlahMekanik"
        [isHarapanTarget]="false"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>
    <!-- UNIT ENTRY SEDANG REALISASI vs TOTAL -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="UNIT ENTRY SEDANG REALISASI vs TOTAL"
        headerColor="#588000"
        [realisasi]="kpiData()!.unitEntrySedangRealisasi.realisasi"
        [target]="kpiData()!.unitEntry.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="true"
        [mekanik]="additionalKpiData()?.jumlahMekanik"
        [isHarapanTarget]="false"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>
    <!-- UNIT ENTRY BERAT REALISASI vs TOTAL -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="UNIT ENTRY BERAT REALISASI vs TOTAL"
        headerColor="#588000"
        [realisasi]="kpiData()!.unitEntryBeratRealisasi.realisasi"
        [target]="kpiData()!.unitEntry.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="true"
        [mekanik]="additionalKpiData()?.jumlahMekanik"
        [isHarapanTarget]="false"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>
    <!-- UNIT ENTRY OVERHOUL REALISASI vs TOTAL -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="UNIT ENTRY OVERHOUL REALISASI vs TOTAL"
        headerColor="#588000"
        [realisasi]="kpiData()!.unitEntryOverhoulRealisasi.realisasi"
        [target]="kpiData()!.unitEntry.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="true"
        [mekanik]="additionalKpiData()?.jumlahMekanik"
        [isHarapanTarget]="false"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>
    <!-- UNIT ENTRY KELISTRIKAN REALISASI vs TOTAL -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="UNIT ENTRY KELISTRIKAN REALISASI vs TOTAL"
        headerColor="#588000"
        [realisasi]="kpiData()!.unitEntryKelistrikanRealisasi.realisasi"
        [target]="kpiData()!.unitEntry.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="true"
        [mekanik]="additionalKpiData()?.jumlahMekanik"
        [isHarapanTarget]="false"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>
    <!-- UNIT ENTRY OVERSIZE REALISASI vs TOTAL -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="SABLET UNIT ENTRY OVERSIZE REALISASI vs TOTAL"
        headerColor="#588000"
        [realisasi]="kpiData()!.unitEntryOverSizeRealisasi.realisasi"
        [target]="kpiData()!.unitEntry.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="true"
        [mekanik]="additionalKpiData()?.jumlahMekanik"
        [isHarapanTarget]="false"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>
    <!-- UNIT ENTRY BODY REPAIR REALISASI vs TOTAL -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="SABLET UNIT ENTRY BODY REPAIR REALISASI vs TOTAL"
        headerColor="#588000"
        [realisasi]="kpiData()!.unitEntryBodyRepairRealisasi.realisasi"
        [target]="kpiData()!.unitEntry.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="true"
        [mekanik]="additionalKpiData()?.jumlahMekanik"
        [isHarapanTarget]="false"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>
    <div class="d-flex align-items-center ms-2">
      <i class="bi bi-receipt-cutoff me-2 fs-4" style="color: #588000"></i>
      <h6 class="mb-0 fw-bold text-dark ms-2">NON CPUS UNIT ENTRY</h6>
    </div>
    <!-- UNIT ENTRY CLAIM REALISASI vs TOTAL -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="UNIT ENTRY CLAIM REALISASI vs TOTAL"
        headerColor="#588000"
        [realisasi]="kpiData()!.unitEntryClaimRealisasi.realisasi"
        [target]="kpiData()!.unitEntry.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="true"
        [mekanik]="additionalKpiData()?.jumlahMekanik"
        [isHarapanTarget]="false"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>
    <!-- UNIT ENTRY KUPON REALISASI vs TOTAL -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="UNIT ENTRY KUPON REALISASI vs TOTAL"
        headerColor="#588000"
        [realisasi]="kpiData()!.unitEntryKuponRealisasi.realisasi"
        [target]="kpiData()!.unitEntry.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="true"
        [mekanik]="additionalKpiData()?.jumlahMekanik"
        [isHarapanTarget]="false"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>
    <!-- UNIT ENTRY PDC REALISASI vs TOTAL -->
    <div class="col-12 col-sm-4 col-md-6 col-lg-5th">
      <app-kpi-card-as
        title="UNIT ENTRY PDC REALISASI vs TOTAL"
        headerColor="#588000"
        [realisasi]="kpiData()!.unitEntryPdcRealisasi.realisasi"
        [target]="kpiData()!.unitEntry.target"
        [unitEntry]="getTotalUnitEntry()"
        [sisaHariKerja]="getSisaHariKerja()"
        [loading]="loading()"
        [isUnit]="true"
        [mekanik]="additionalKpiData()?.jumlahMekanik"
        [isHarapanTarget]="false"
        [compare]="currentFilter()?.compare || false"
      >
      </app-kpi-card-as>
    </div>
  </div>
  }

  <!-- Empty State -->
  @if (!hasData() && !loading() && !error()) {
  <div class="row">
    <div class="col-12">
      <div class="text-center py-5">
        <i class="bi bi-bar-chart text-muted fs-1 mb-3"></i>
        <h6 class="text-muted mb-0">
          Belum ada data untuk ditampilkan. Silakan pilih filter dan klik cari.
        </h6>
      </div>
    </div>
  </div>
  }
</div>
