<!-- dashboard.component.html -->
<div class="container-fluid p-4">
  <!-- Header Section -->
  <div class="row mb-4">
    <div class="col-12">
      <h2 class="fw-bold text-dark mb-3">
        Dashboard <span class="text-primary">Galesong Otomotif</span>
      </h2>

      <!-- Filter Section -->
      <div class="row bg-white shadow-sm align-items-end rounded-3 p-3 g-3">
        <div class="col-md-6 col-lg-2">
          <label for="company-select" class="form-label small text-muted">Perusahaan</label>
          <select id="company-select" class="form-select" [(ngModel)]="activeFilter().companyId" (ngModelChange)="applyFilter()">
            @for (company of filterOptions().companies; track company.id) {
              <option [value]="company.id">{{ company.name }}</option>
            }
          </select>
        </div>

        <div class="col-md-6 col-lg-2">
          <label for="branch-select" class="form-label small text-muted">Cabang</label>
          <select id="branch-select" class="form-select" [(ngModel)]="activeFilter().branchId" (ngModelChange)="applyFilter()">
            @for (branch of filterOptions().branches; track branch.id) {
              <option [value]="branch.id">{{ branch.name }}</option>
            }
          </select>
        </div>

        <div class="col-md-6 col-lg-2">
          <label for="category-select" class="form-label small text-muted">Kategori</label>
          <select id="category-select" class="form-select" [(ngModel)]="activeFilter().category" (ngModelChange)="applyFilter()">
            @for (category of filterOptions().categories; track category.id) {
              <option [value]="category.id">{{ category.name }}</option>
            }
          </select>
        </div>

        <div class="col-md-6 col-lg-2">
          <label for="year-select" class="form-label small text-muted">Tahun</label>
          <select id="year-select" class="form-select" [(ngModel)]="activeFilter().year" (ngModelChange)="applyFilter()">
             @for (year of filterOptions().years; track year) {
              <option [value]="year">{{ year }}</option>
            }
          </select>
        </div>

        <div class="col-lg-4">
            <div class="card bg-light border-0 h-100">
                <div class="card-body text-center d-flex align-items-center justify-content-center p-2">
                    @if (cacheStatus().isValid) {
                        <small class="text-success">
                            <i class="bi bi-check-circle-fill me-1"></i>
                            Data valid, cache kedaluwarsa dalam: <strong>{{ cacheStatus().expiresIn }}</strong>
                        </small>
                    } @else {
                        <small class="text-muted">
                             <i class="bi bi-info-circle-fill me-1"></i>
                            Cache tidak valid atau data baru.
                        </small>
                    }
                </div>
            </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content Area -->
  <div class="content-wrapper">
    <!-- Loading State -->
    @if (isLoading()) {
      <div class="text-center p-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-3 text-muted">Memuat data dashboard...</p>
      </div>
    }

    <!-- Error State -->
    @if (error(); as errorMessage) {
      <div class="alert alert-danger d-flex flex-column align-items-center p-4">
        <h5 class="alert-heading">Terjadi Kesalahan</h5>
        <p>Gagal memuat data. Silakan coba lagi.</p>
        <p><small class="text-muted">{{ errorMessage }}</small></p>
        <button class="btn btn-danger mt-2" (click)="retryLoad()">
          Coba Lagi
        </button>
      </div>
    }

    <!-- Data Ready State -->
    @if (hasData() && !isLoading() && !error()) {
      <div class="row g-4">
        <!-- KPI Cards -->
        @for (kpi of kpiData(); track kpi.id) {
          <div class="col-xl-3 col-md-6">
            <app-kpi-card [data]="kpi"></app-kpi-card>
          </div>
        }

        <!-- Placeholder for Charts -->
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center p-5 bg-light rounded-3">
                    <p class="h5 text-muted">Area untuk Chart dan Visualisasi Data</p>
                    <small class="text-muted">Implementasi Chart.js akan ditambahkan di sini.</small>
                </div>
            </div>
        </div>
      </div>
    }
  </div>
</div>
