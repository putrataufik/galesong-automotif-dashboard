<!-- src/app/shared/components/kpi-card-as/kpi-card-as.component.html -->
<div class="kpi-card-as compact shadow-soft rounded-4 position-relative">
  <!-- Header pill -->
  <div class="header-chip-wrapper" [style.background]="headerColor">
    <div class="chip-title">{{ title }}</div>
  </div>

  <!-- Body -->
  <div class="content-section">
    <!-- tambahkan flex-wrap agar rapi di layar kecil -->
    <div
      class="d-flex flex-wrap align-items-start justify-content-between gap-2 gap-md-2"
    >
      <!-- Persentase -->
      <div
        class="percentage-display flex-shrink-0 d-flex align-items-center justify-content-center"
      >
        {{ formatPercentage(percentage) }}
      </div>

      <!-- Detail Rows -->
      <div class="details flex-grow-1">
        <div class="detail-row">
          <span>Deviasi Target</span>
          <span class="fw-bold" [ngClass]="getValueColor(grandTotal)">
            {{ formatValue(grandTotal) }}
          </span>
        </div>
        <div class="detail-row">
          <span>Rata - Rata</span>
          <span class="fw-bold">{{ formatRataRataDisplay(rataRata) }}</span>
        </div>
        @if (showHarapanTarget) {
        <div class="detail-row">
          <span>Harapan Target</span>
          <span class="fw-bold">
            {{ formatValue(harapanTarget) }}{{ getUnitSuffix() }} / Hari
          </span>
        </div>
        }
      </div>

      <!-- Progress taruh di baris baru saat kecil -->
      <div class="w-100 mt-md-1">
        <div class="progress rounded-pill position-relative">
          <div
            class="progress-bar"
            [ngStyle]="getProgressBarStyle()"
            role="progressbar"
            [attr.aria-valuenow]="clampedPercent"
            aria-valuemin="0"
            aria-valuemax="100"
            [style.width.%]="clampedPercent"
          ></div>
          <div class="progress-text position-absolute w-100 text-center">
            {{ formatValue(realisasi) }} / {{ formatValue(target) }}
          </div>
        </div>
      </div>
    </div>

    @if(compare){
    <hr class="period-sep my-2" />

    <!-- ====== PERIOD: 2025 July ====== -->
    <div class="period-label mt-2">
      <span class="badge badge-soft-primary">2025 July</span>
    </div>

    <div
      class="d-flex flex-wrap align-items-start justify-content-between gap-2 gap-md-2"
    >
      <!-- Persentase -->
      <div
        class="percentage-display flex-shrink-0 d-flex align-items-center justify-content-center"
      >
        17%
      </div>

      <!-- Detail Rows -->
      <div class="details flex-grow-1">
        <div class="detail-row">
          <span>Deviasi Target</span>
          <span class="fw-bold" [ngClass]="getValueColor(-150)">
            {{ formatValue(-150) }}
          </span>
        </div>
        <div class="detail-row">
          <span>Rata - Rata</span>
          <span class="fw-bold">{{ formatRataRataDisplay(150) }}</span>
        </div>
      </div>

      <!-- Progress -->
      <div class="w-100 mt-md-1">
        <div class="progress rounded-pill position-relative">
          <div
            class="progress-bar"
            [ngStyle]="getProgressBarStyle()"
            role="progressbar"
            [attr.aria-valuenow]="clampedPercent"
            aria-valuemin="0"
            aria-valuemax="100"
            [style.width.%]="clampedPercent"
          ></div>
          <div class="progress-text position-absolute w-100 text-center">
            {{ formatValue(600000000) }} / {{ formatValue(550000000) }}
          </div>
        </div>
      </div>
    </div>

    <!-- Garis pemisah antar-periode -->
    <hr class="period-sep my-2" />

    <!-- ====== PERIOD: 2024 Aug ====== -->
    <div class="period-label">
      <span class="badge badge-soft-warning">2024 Aug</span>
    </div>

    <div
      class="d-flex flex-wrap align-items-start justify-content-between gap-2 gap-md-2"
    >
      <!-- Persentase -->
      <div
        class="percentage-display flex-shrink-0 d-flex align-items-center justify-content-center"
      >
        {{ formatPercentage(17) }}
      </div>

      <!-- Detail Rows -->
      <div class="details flex-grow-1">
        <div class="detail-row">
          <span>Deviasi Target</span>
          <span class="fw-bold" [ngClass]="getValueColor(-200000)">
            {{ formatValue(-40000000) }}
          </span>
        </div>
        <div class="detail-row">
          <span>Rata - Rata</span>
          <span class="fw-bold">{{ formatRataRataDisplay(150) }}</span>
        </div>
      </div>

      <!-- Progress -->
      <div class="w-100 mt-md-1">
        <div class="progress rounded-pill position-relative">
          <div
            class="progress-bar"
            [ngStyle]="getProgressBarStyle()"
            role="progressbar"
            [attr.aria-valuenow]="clampedPercent"
            aria-valuemin="0"
            aria-valuemax="100"
            [style.width.%]="clampedPercent"
          ></div>
          <div class="progress-text position-absolute w-100 text-center">
            {{ formatValue(1000000) }} / {{ formatValue(20000000) }}
          </div>
        </div>
      </div>
    </div>
    } @if (loading) {
    <div
      class="loading-overlay d-flex align-items-center justify-content-center position-absolute top-0 start-0 w-100 h-100"
    >
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
    }
  </div>
</div>
