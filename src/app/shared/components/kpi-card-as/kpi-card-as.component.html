<!-- src/app/shared/components/kpi-card-as/kpi-card-as.component.html -->
<div class="kpi-card-as compact shadow-soft rounded-4 position-relative">
    <!-- Header pill -->
    <div class="header-chip-wrapper" [style.background]="headerColor">
        <div class="chip-title">{{ title }}</div>
    </div>


    <!-- Body -->
    <div class="content-section">
        <!-- Percentage Display -->
        <div class="text-center mb-3">
            <div class="percentage-display">{{ formatPercentage(percentage) }}</div>
            <div class="progress rounded-pill position-relative">
                <div class="progress-bar rounded-pill" [ngStyle]="getProgressBarStyle()" role="progressbar"
                    [attr.aria-valuenow]="clampedPercent" aria-valuemin="0" aria-valuemax="100"
                    [style.width.%]="clampedPercent">
                </div>
                <div class="progress-text position-absolute w-100 text-center">
                    {{ formatValue(realisasi) }} / {{ formatValue(target) }}
                </div>
            </div>
        </div>

        <!-- Detail Rows -->
        <div class="details">
            <div class="detail-row">
                <span>Deviasi Target</span>
                <span class="fw-bold" [ngClass]="getValueColor(grandTotal)">
                    {{ formatValue(grandTotal) }}
                </span>
            </div>
            <div class="detail-row">
                <span>Rata - Rata</span>
                <span class="fw-bold">
                    {{ formatValue(rataRata) }} / unit
                </span>
            </div>
            @if (showHarapanTarget) {
            <div class="detail-row">
                <span>Harapan Target</span>
                <span class="fw-bold">
                    {{ formatValue(harapanTarget) }}{{ getUnitSuffix() }} / Hari
                </span>
            </div>
            }
        </div>
    </div>

    @if (loading) {
    <div
        class="loading-overlay d-flex align-items-center justify-content-center position-absolute top-0 start-0 w-100 h-100">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
    }
</div>