<!-- src/app/shared/components/kpi-card-as/kpi-card-as.component.html -->
<div class="kpi-card-as compact shadow-soft rounded-4 position-relative">
  <!-- Header pill -->
  <div class="header-chip-wrapper" [style.background]="headerColor">
    <div class="chip-title">{{ title }}</div>
  </div>

  <!-- Body -->
  <div class="content-section">
    <!-- Realisasi / Target -->
    <div class="detail-row d-flex flex-column align-items-center">
      <span class="">Realisasi / Target</span>
      <div class="w-100">
        <div class="progress rounded-pill position-relative">
          <div
            class="progress-bar"
            [ngStyle]="getProgressBarStyle()"
            role="progressbar"
            [attr.aria-valuenow]="clampedPercent"
            aria-valuemin="0"
            aria-valuemax="100"
            [style.width.%]="clampedPercent"
          ></div>
          <div class="progress-text position-absolute w-100 text-center">
            {{ formatValue(realisasi) }} / {{ formatValue(target) }}
          </div>
        </div>
      </div>
    </div>

    <!-- Ringkasan -->
    <div class="row g-2 align-items-center justify-content-center">
      <!-- Persentase -->
      <div class="col-auto d-flex align-items-center">
        <div
          class="percentage-display d-flex align-items-center justify-content-center"
        >
          {{ formatPercentage(percentage) }}
        </div>
      </div>

      <!-- Detail -->
      <div class="col">
        <div class="details">
          <div class="detail-row d-flex justify-content-between">
            <span>Deviasi Target</span>
            <span class="fw-bold" [ngClass]="getValueColor(grandTotal)">
              {{ formatValue(grandTotal) }}
            </span>
          </div>
          <div class="detail-row d-flex justify-content-between">
            <span>Rata - Rata</span>
            <span class="fw-bold">{{ formatRataRataDisplay(rataRata) }}</span>
          </div>
          @if (showHarapanTarget) {
          <div class="detail-row d-flex justify-content-between">
            <span>Harapan Target</span>
            <span class="fw-bold">
              {{ formatValue(harapanTarget) }}{{ getUnitSuffix() }} / Hari
            </span>
          </div>
          }
        </div>
      </div>
    </div>

    @if(compare){
    <hr class="period-sep my-2" />

    <!-- ====== PERIOD: 2025 July ====== -->
    <div class="period-label mt-1">
      <span class="badge badge-soft-primary">2025 July</span>
    </div>

    <div class="row g-2 align-items-start">
      <!-- Persentase -->
      <div class="col-auto">
        <div
          class="percentage-display d-flex align-items-center justify-content-center"
        >
          17%
        </div>
      </div>

      <!-- Detail -->
      <div class="col">
        <div class="details">
          <div class="detail-row d-flex justify-content-between">
            <span>Deviasi Target</span>
            <span class="fw-bold" [ngClass]="getValueColor(-150)">
              {{ formatValue(-150) }}
            </span>
          </div>
          <div class="detail-row d-flex justify-content-between">
            <span>Rata - Rata</span>
            <span class="fw-bold">{{ formatRataRataDisplay(150) }}</span>
          </div>
        </div>
      </div>

      <!-- Progress -->
      <div class="col-12 mt-1">
        <div class="progress rounded-pill position-relative">
          <div
            class="progress-bar"
            [ngStyle]="getProgressBarStyle()"
            role="progressbar"
            [attr.aria-valuenow]="clampedPercent"
            aria-valuemin="0"
            aria-valuemax="100"
            [style.width.%]="clampedPercent"
          ></div>
          <div class="progress-text position-absolute w-100 text-center">
            {{ formatValue(600000000) }} / {{ formatValue(550000000) }}
          </div>
        </div>
      </div>
    </div>

    <hr class="period-sep my-2" />

    <!-- ====== PERIOD: 2024 Aug ====== -->
    <div class="period-label">
      <span class="badge badge-soft-warning">2024 Aug</span>
    </div>

    <div class="row g-2 align-items-start">
      <!-- Persentase -->
      <div class="col-auto">
        <div
          class="percentage-display d-flex align-items-center justify-content-center"
        >
          {{ formatPercentage(17) }}
        </div>
      </div>

      <!-- Detail -->
      <div class="col">
        <div class="details">
          <div class="detail-row d-flex justify-content-between">
            <span>Deviasi Target</span>
            <span class="fw-bold" [ngClass]="getValueColor(-200000)">
              {{ formatValue(-40000000) }}
            </span>
          </div>
          <div class="detail-row d-flex justify-content-between">
            <span>Rata - Rata</span>
            <span class="fw-bold">{{ formatRataRataDisplay(150) }}</span>
          </div>
        </div>
      </div>

      <!-- Progress -->
      <div class="col-12 mt-1">
        <div class="progress rounded-pill position-relative">
          <div
            class="progress-bar"
            [ngStyle]="getProgressBarStyle()"
            role="progressbar"
            [attr.aria-valuenow]="clampedPercent"
            aria-valuemin="0"
            aria-valuemax="100"
            [style.width.%]="clampedPercent"
          ></div>
          <div class="progress-text position-absolute w-100 text-center">
            {{ formatValue(1000000) }} / {{ formatValue(20000000) }}
          </div>
        </div>
      </div>
    </div>
    } @if (loading) {
    <div
      class="loading-overlay d-flex align-items-center justify-content-center position-absolute top-0 start-0 w-100 h-100"
    >
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
    }
  </div>
</div>
