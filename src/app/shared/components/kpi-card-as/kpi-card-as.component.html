<!-- src/app/shared/components/kpi-card-as/kpi-card-as.component.html -->
<div class="kpi-card-as compact shadow-soft rounded-4 position-relative">
  <!-- Header pill -->
  <div class="header-chip-wrapper" [style.background]="headerColor">
    <div class="chip-title">{{ title }}</div>
  </div>

  <!-- Body -->
  <div class="content-section">
    <!-- Realisasi / Target -->
    <div class="detail-row d-flex flex-column align-items-center">
      <span>Realisasi / Target</span>
      <div class="w-100">
        <div class="progress rounded-pill position-relative">
          <div
            class="progress-bar"
            [ngStyle]="getProgressBarStyle()"
            role="progressbar"
            [attr.aria-valuenow]="clampedPercent"
            aria-valuemin="0"
            aria-valuemax="100"
            [style.width.%]="clampedPercent"
          ></div>
          <div class="progress-text position-absolute w-100 text-center">
            {{ formatValue(realisasi) }} / {{ formatValue(target) }}
          </div>
        </div>
      </div>
    </div>

    <!-- Ringkasan -->
    <div class="row g-2 align-items-center justify-content-center">
      <!-- Persentase -->
      <div class="col-auto d-flex align-items-center">
        <div
          class="percentage-display d-flex align-items-center justify-content-center"
        >
          {{ formatPercentage(percentage) }}
        </div>
      </div>

      <!-- Detail -->
      <div class="col">
        <div class="details">
          <div
            class="detail-row d-flex justify-content-between align-items-center"
          >
            <span>Deviasi Target</span>
            <span class="fw-bold" [ngClass]="getValueColor(grandTotal)">
              {{ formatValue(grandTotal) }}
            </span>
          </div>
          <div class="detail-row d-flex justify-content-between">
            <span>Rata - Rata</span>
            <span class="fw-bold">{{ formatRataRataDisplay(rataRata) }}</span>
          </div>

          @if (showHarapanTarget) {
          <div class="detail-row d-flex justify-content-between">
            <span>Harapan Target</span>
            <span class="fw-bold">
              {{ formatValue(harapanTarget) }}{{ getUnitSuffix() }} / Hari
            </span>
          </div>
          }
        </div>
      </div>
    </div>

    <!-- Compare blocks -->
    @if (compare) {
    <hr class="period-sep" />

    <!-- Prev Month -->
    @if (prevMPeriod) {
    <div class="period-label mb-2">
      <span class="badge badge-soft-primary">{{ prevMPeriod }}</span>
    </div>

    <div class="row g-2 align-items-start">
      <!-- Progress -->
      <div class="col-12 mt-1">
        <div class="progress rounded-pill position-relative">
          <div
            class="progress-bar"
            [ngStyle]="getProgressBarStyleForPercent(prevMPercentage)"
            role="progressbar"
            [attr.aria-valuenow]="prevMPercentage"
            aria-valuemin="0"
            aria-valuemax="100"
            [style.width.%]="prevMPercentage"
          ></div>
          <div class="progress-text position-absolute w-100 text-center">
            {{ formatValue(prevMRealisasi) }} / {{ formatValue(prevMTarget) }}
          </div>
        </div>
      </div>
      <div class="row g-2 align-items-center justify-content-center">
        <!-- Persentase -->
        <div class="col-auto">
          <div
            class="percentage-display d-flex align-items-center justify-content-center"
          >
            {{ formatPercentage(prevMPercentage) }}
          </div>
        </div>

        <!-- Detail -->
        <div class="col">
          <div class="details">
            <div
              class="detail-row d-flex justify-content-between align-items-center"
            >
              <span>Deviasi Target</span>
              <span class="fw-bold" [ngClass]="getValueColor(prevMDeviation)">
                {{ formatValue(prevMDeviation) }}
              </span>
            </div>
            <div class="detail-row d-flex justify-content-between">
              <span>Rata - Rata</span>
              <span class="fw-bold">{{
                formatRataRataDisplay(prevMRataRata)
              }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <hr class="period-sep" />
    }

    <!-- Prev Year -->
    @if (prevYPeriod) {
    <div class="period-label">
      <span class="badge badge-soft-warning mb-2">{{ prevYPeriod }}</span>
    </div>

    <div class="row g-2 align-items-start">
      <!-- Progress -->
      <div class="col-12 mt-1">
        <div class="progress rounded-pill position-relative">
          <div
            class="progress-bar"
            [ngStyle]="getProgressBarStyleForPercent(prevYPercentage)"
            role="progressbar"
            [attr.aria-valuenow]="prevYPercentage"
            aria-valuemin="0"
            aria-valuemax="100"
            [style.width.%]="prevYPercentage"
          ></div>
          <div class="progress-text position-absolute w-100 text-center">
            {{ formatValue(prevYRealisasi) }} / {{ formatValue(prevYTarget) }}
          </div>
        </div>
      </div>
      <div class="row g-2 align-items-center justify-content-center">
        <!-- Persentase -->
        <div class="col-auto">
          <div
            class="percentage-display d-flex align-items-center justify-content-center"
          >
            {{ formatPercentage(prevYPercentage) }}
          </div>
        </div>

        <!-- Detail -->
        <div class="col">
          <div class="details">
            <div class="detail-row d-flex justify-content-between">
              <span>Deviasi Target</span>
              <span class="fw-bold" [ngClass]="getValueColor(prevYDeviation)">
                {{ formatValue(prevYDeviation) }}
              </span>
            </div>
            <div class="detail-row d-flex justify-content-between">
              <span>Rata - Rata</span>
              <span class="fw-bold">{{
                formatRataRataDisplay(prevYRataRata)
              }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    } } @if (loading) {
    <div
      class="loading-overlay d-flex align-items-center justify-content-center position-absolute top-0 start-0 w-100 h-100"
    >
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
    }
  </div>
</div>
